<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Capitals Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/5v20+7V3hkq3IGjRIyhILviNPxC/+rsRTcfjNm" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1 class="text-center mt-5">Country Capitals Quiz</h1>
        <h3 id="country" class="mt-5"></h3>

        <form id="answer-form" class="mt-3" method="POST" action="/">
            <div id="options">
                <div class="form-check">
                    <input class="form-check-input option" type="radio" name="capital" id="option1" value="">
                    <label class="form-check-label" for="option1" id="option1label"></label>
                </div>
                <div class="form-check">
                    <input class="form-check-input option" type="radio" name="capital" id="option2" value="">
                    <label class="form-check-label" for="option2" id="option2label"></label>
                </div>
                <div class="form-check">
                    <input class="form-check-input option" type="radio" name="capital" id="option3" value="">
                    <label class="form-check-label" for="option3" id="option3label"></label>
                </div>
            </div>
            <input type="hidden" name="correct-answer" id="correct-answer">
            <button type="submit" class="btn btn-primary mt-3">Check my answer</button>
        </form>

        <div class="progress mt-3" style="height: 25px;">
            <div id="progress-bar" class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="195">0/195</div>
        </div>

        <h4 id="score" class="mt-3">Score: 0</h4>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/5v20+7V3hkq3IGjRIyhILviNPxC/+rsRTcfjNm" crossorigin="anonymous"></script>
    <script>
        document.getElementById("answer-form").addEventListener("submit", async(event) => {
            event.preventDefault();

            const formData = new FormData(event.target);

            const response = await fetch("/", {
                method: "POST",
                body: formData,
            });

            const {
                country,
                options,
                correct_capital,
                score
            } = await response.json();

            document.getElementById("country").textContent = country;
            document.getElementById("score").textContent = `Score: ${score}`;

            document.querySelectorAll(".option").forEach((radio, index) => {
                radio.value = options[index];
                radio.nextElementSibling.textContent = options[index];
            });

            document.getElementById("correct-answer").value = correct_capital;

            const progressBar = document.getElementById("progress-bar");
            const progress = (score / 195) * 100;
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `${score}/195`;
        });
    </script>
</body>