<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl7/1ZrireUJruMs1zd0zE6mb5RpQ5rrR9M7BR1zPM" crossorigin="anonymous">
    <style>
        .text-green {
            color: green;
        }
        
        .text-red {
            color: red;
        }
    </style>
    <title>Capital City Quiz</title>
</head>

<body>
    <div class="container">
        <h1 class="text-center mt-4">Capital City Quiz</h1>
        <div class="row mt-5">
            <div class="col-12 col-md-8 offset-md-2">
                <form id="quiz-form">
                    <input type="hidden" name="country" value="">
                    <input type="hidden" name="correct_answer" value="">
                    <p>What is the capital of ?</p>
                    <div class="options">
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">Check my answer</button>
                </form>
                <p class="mt-4" id="score">Score: 0</p>
                <p class="mt-4" id="feedback"></p>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <script>
        let score = 0;

        document.getElementById("quiz-form").addEventListener("submit", function(event) {
            event.preventDefault();
            const correct_answer = document.querySelector("input[name='correct_answer']").value;
            const selected_answer = document.querySelector("input[name='answer']:checked").value;
            const feedback = document.getElementById("feedback");

            if (correct_answer === selected_answer) {
                score += 1;
                // alert("Correct!");
                //document.getElementById("feedback").textContent = "Correct!";
                feedback.textContent = "Correct!";
                feedback.classList.remove("text-red");
                feedback.classList.add("text-green");
            } else {
                score = 0;
                // alert(`Incorrect! The capital of ${event.target.country.value} is ${correct_answer}. Your score has been reset to 0.`);
                //document.getElementById("feedback").textContent = `Incorrect! The capital of ${event.target.country.value} is ${correct_answer}. Your score has been reset to 0.`;
                feedback.textContent = `Incorrect! The capital of ${event.target.country.value} is ${correct_answer}. Your score has been reset to 0.`;
                feedback.classList.remove("text-green");
                feedback.classList.add("text-red");
            }

            document.getElementById("score").textContent = `Score: ${score}`;
            fetchNewQuestion();
        });

        function fetchNewQuestion() {
            fetch('/next-question', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    document.querySelector("input[name='country']").value = data.country;
                    document.querySelector("input[name='correct_answer']").value = data.correct_answer;
                    document.querySelector("p").textContent = `What is the capital of ${data.country}?`;

                    const optionsDiv = document.querySelector(".options");
                    optionsDiv.innerHTML = "";
                    data.options.forEach((option, index) => {
                        const formCheckDiv = document.createElement("div");
                        formCheckDiv.className = "form-check";

                        const input = document.createElement("input");
                        input.className = "form-check-input";
                        input.type = "radio";
                        input.name = "answer";
                        input.id = `answer${index + 1}`;
                        input.value = option;

                        const label = document.createElement("label");
                        label.className = "form-check-label";
                        label.htmlFor = `answer${index + 1}`;
                        label.textContent = option;

                        formCheckDiv.appendChild(input);
                        formCheckDiv.appendChild(label);
                        optionsDiv.appendChild(formCheckDiv);
                    });

                    // Deselect any previously selected radio buttons.
                    document.querySelectorAll("input[name='answer']").forEach(radio => {
                        radio.checked = false;
                    });
                });
        }

        // Fetch the first question when the page loads.
        fetchNewQuestion();
    </script>
</body>